(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{"./app/scripts/view-models/calendar-view-state.js":function(e,t,r){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u=r("./app/scripts/view-models/internal/local-storage-model.js");e.exports=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(h,e);var t,r,u,l,d=(t=h,function(){var e,r=c(t);if(o()){var n=c(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return s(this,e)});function h(){return n(this,h),d.apply(this,arguments)}return r=h,(u=[{key:"default",value:function(){return{mode:"month"}}},{key:"getMode",value:function(){return this.get("mode")}},{key:"setMode",value:function(e){return this.update("mode",e)}}])&&i(r.prototype,u),l&&i(r,l),h}(u)},"./app/scripts/views/calendar/calendar-card-view.js":function(e,t,r){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u,l=r("./app/scripts/views/card/card-view.js");e.exports=((u=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(h,e);var t,r,u,l,d=(t=h,function(){var e,r=c(t);if(o()){var n=c(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return s(this,e)});function h(){return n(this,h),d.apply(this,arguments)}return r=h,l=[{key:"initClass",value:function(){this.prototype.onCalendar=!0}}],(u=null)&&i(r.prototype,u),l&&i(r,l),h}(l)).initClass(),u=u)},"./app/scripts/views/calendar/calendar-check-item-view.ts":function(e,t,r){"use strict";r.r(t),r.d(t,"CalendarCheckItemView",(function(){return C}));var n=r("./app/scripts/controller/index.js"),i=r.n(n),a=r("./app/scripts/lib/util/index.js"),s=r.n(a),o=r("./app/scripts/views/internal/view.js"),c=r.n(o),u=r("./app/scripts/lib/markdown/tfm.js"),l=r.n(u),d=r("./app/scripts/views/internal/teacup-with-helpers.js"),h=r.n(d),p=r("./app/scripts/views/internal/friendly-links.js"),f=r.n(p),v=r("./app/scripts/controller/currentModelManager.ts");function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?b(e):t}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var _=h()(),D=_.renderable((function(e){var t=e.editable,r=e.cardName,n=e.cardUrl;return _.a(".calendar-check-item",{href:n},(function(){_.div(".calendar-check-item-checkbox",(function(){return _.div(".checklist-item-checkbox",{class:_.classify({enabled:t,"js-toggle-checklist-item":t})},(function(){return _.span(".checklist-item-checkbox-check")}))})),_.div(".calendar-check-item-details",(function(){_.div(".checklist-item-details-text.markeddown.js-name"),_.div(".calendar-check-item-card.js-card-name",(function(){return _.text(r)}))}))}))})),C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(c,e);var t,r,n,a,o=(t=c,function(){var e,r=j(t);if(g()){var n=j(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return k(this,e)});function c(){var e;y(this,c);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return O(b(e=o.call.apply(o,[this].concat(r))),"_visible",!0),O(b(e),"events",{click(e){s.a.stopPropagation(e);var t=e.target&&e.target.closest("a");t&&!t.classList.contains("calendar-check-item")||(s.a.stop(e),i.a.showCardDetail(this.model.getCard(),{method:"from checkitem on calendar"}))},"click .js-toggle-checklist-item"(e){s.a.stop(e),this.toggleState()},moveToCalendarDay(e,t,r){var n=new Date(r.data.day);t.item.remove(),this.model.changeDueDateMaintainTime(n)}}),e}return r=c,(n=[{key:"className",value:function(){return"calendar-check-item-container"}},{key:"initialize",value:function(){this.makeDebouncedMethods("renderFiltered");var e=this.model.getCard(),t=this.model.getBoard();this.listenTo(this.model,"change:name",this.renderName),this.listenTo(this.model,"change:state",this.renderState),this.listenTo(e,"change:name",this.renderCardName),this.listenTo(this.model,"change:name change:due change:idMember change:state",this.renderFilteredDebounced),this.listenTo(e,"change:idLabels",this.renderFilteredDebounced),this.listenTo(t.filter,"change",this.renderFilteredDebounced)}},{key:"render",value:function(){var e=this.model.getCard(),t=e.editable(),r="complete"===this.model.get("state");return this.$el.html(D({complete:r,editable:t,cardName:e.get("name"),cardUrl:i.a.getCardUrl(e)})),this.renderState(),this.renderName(),this.renderFiltered(),this}},{key:"renderCardName",value:function(){return this.$(".js-card-name").html(this.model.getCard().get("name")),this}},{key:"renderName",value:function(){var e=this.$(".js-name");return e.html(l.a.checkItems.format(this.model.get("name"),{textData:this.model.get("nameData")}).output),f()(e[0],this.model.getBoard()),this}},{key:"renderState",value:function(){var e=this.model.getCard().editable(),t=Boolean(e&&this.model.getBoard().hasAdvancedChecklists()),r="complete"===this.model.get("state");this.$el.toggleClass("checklist-item-state-complete",r).toggleClass("js-draggable-calendar-check-item",t)}},{key:"renderFiltered",value:function(){var e=this.model.getBoard(),t=!e||!v.currentModelManager.onBoardView(e.id)||e.filter.checkItemSatisfiesFilter(this.model);t!==this._visible&&(this._visible=t,this.$el.toggleClass("hide",!t).height(t?"":0))}},{key:"toggleState",value:function(){this.model.update("state","complete"===this.model.get("state")?"incomplete":"complete")}}])&&m(r.prototype,n),a&&m(r,a),c}(c.a)},"./app/scripts/views/calendar/calendar-controller-view.js":function(e,t,r){function n(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,r){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var h=r("./packages/jquery/index.js"),p=r("./app/scripts/views/card-composer/calendar-card-composer-view.js"),f=r("./app/scripts/views/calendar/calendar-month-view.js"),v=r("./app/scripts/view-models/calendar-view-state.js"),y=r("./app/scripts/views/calendar/calendar-week-view.js"),m=r("./app/scripts/views/power-ups/calendar-settings-view.js"),w=r("./app/scripts/lib/dates.js"),k=r("./app/scripts/db/auth.js"),b=r("./node_modules/moment/moment.js"),g=r("./app/scripts/views/lib/pop-over.js"),j=r("./app/scripts/lib/util/index.js"),O=r("./app/scripts/views/internal/view.js"),_=r("./app/scripts/lib/window-size.js"),D=r("./app/scripts/views/internal/templates.js"),C=r("./app/scripts/data/legacy-power-ups.js").calendar,E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(T,e);var t,i,O,E,R=(t=T,function(){var e,r=d(t);if(l()){var n=d(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return u(this,e)});function T(){return a(this,T),R.apply(this,arguments)}return i=T,E=[{key:"initClass",value:function(){this.prototype.className="calendar-wrapper",this.prototype.events={"click .js-week-view":"switchToWeekViewFromMonth","click .js-month-view":"switchToMonthViewFromWeek","click .js-left-arrow":"navigatePrevious","click .js-right-arrow":"navigateNext","click .js-today":"navigateToday","click .js-open-card-composer":"openComposer","click .js-calendar-settings"(e){return j.stop(e),this.showSettings(e.currentTarget)}}}}],(O=[{key:"initialize",value:function(){return this.monthView=this.subview(f,this.model),this.weekView=this.subview(y,this.model),this.localState=new v({id:"calendar".concat(this.model.id)}),this.localState.fetch(),this.model.viewState.clearSelectedCard()}},{key:"render",value:function(e){null==e&&(e=new Date);var t=w.getDaysOfWeek(e).map((function(e){return b(e).format("ddd")})),n=k.me().getPluginDataByKey(C,"private","dismissedFeedback");return this.$el.html(D.fill(r("./app/scripts/views/templates/calendar_toolbar.js"),{days:t,dismissedFeedback:n})),this.localState.getMode()===y.prototype.VIEWSTATE_PREF_STR?this.showView(this.weekView,e):this.showView(this.monthView,e),this}},{key:"handleClickOutside",value:function(e){if(0===h(e.target).closest(".calendar-day").length&&!g.isVisible)return h(".calendar-day.active").removeClass("active")}},{key:"remove",value:function(){return this.stopSubscriptions(),this.model.viewState.clearSelectedCard(),o(d(T.prototype),"remove",this).apply(this,arguments)}},{key:"showSettings",value:function(e){return g.toggle({elem:e,view:new m({model:this.model}),autoPosition:!0})}},{key:"openComposer",value:function(e){j.stop(e);var t=h(e.target).closest(".day-cell, .day-column"),r=new Date(parseInt(t.attr("name"),10)),n=new p({model:this.model.composer,modelCache:this.modelCache});return n.setDate(r),g.show({clientx:e.clientX,clienty:e.clientY,view:n})}},{key:"showView",value:function(e,t){return this.currentSubView=e,this.$(".calendar-header").removeClass("week-view month-view").addClass(this.currentSubView.HEADER_CLASS_NAME),this.$(".calendar-content").empty().append(this.currentSubView.render(t).el),this.model.viewState.clearSelectedCard(),this.localState.setMode(this.currentSubView.VIEWSTATE_PREF_STR),this.currentSubView.delegateEvents(),this.currentSubView.updateRoute()}},{key:"switchToWeekViewFromMonth",value:function(){return this.showView(this.weekView,this.monthView.currentCenterWeek),this.addedToDOM()}},{key:"switchToMonthViewFromWeek",value:function(){return this.showView(this.monthView,this.weekView.currentWeek),this.addedToDOM()}},{key:"setSubscriptions",value:function(){var e=this;this.stopSubscriptions(),this.currentSubView===this.monthView?this.monthView.setSubscriptions():(h(_).on("windowClassChange.".concat(this.uniqueId()),(function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return e.weekSmallWindowResizeCheck.apply(e,n(Array.from(r||[])))})),this.weekView.setSubscriptions()),h(document).on("click",this.handleClickOutside)}},{key:"stopSubscriptions",value:function(){this.weekView.stopSubscriptions(),this.monthView.stopSubscriptions(),h(_).off(".".concat(this.uniqueId())),h(document).off("click",this.handleClickOutside)}},{key:"delegateEvents",value:function(){return o(d(T.prototype),"delegateEvents",this).apply(this,arguments),null!=this.currentSubView?this.currentSubView.delegateEvents():void 0}},{key:"addedToDOM",value:function(){return this.setSubscriptions(),this.currentSubView.addedToDOM()}},{key:"navigateToday",value:function(){return this.currentSubView.navigateToday()}},{key:"navigatePrevious",value:function(){return this.currentSubView.navigatePrevious()}},{key:"navigateNext",value:function(){return this.currentSubView.navigateNext()}},{key:"weekSmallWindowResizeCheck",value:function(e,t){if(_.fSmall&&this.currentSubView===this.weekView)return this.switchToMonthViewFromWeek()}}])&&s(i.prototype,O),E&&s(i,E),T}(O);E.initClass(),e.exports=E},"./app/scripts/views/calendar/calendar-day-view.js":function(e,t,r){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l=r("./packages/jquery/index.js"),d=r("./app/scripts/views/calendar/calendar-check-item-view.ts").CalendarCheckItemView,h=r("./app/scripts/lib/dates.js"),p=r("./app/scripts/views/lib/drag-sort.js"),f=r("./app/scripts/views/lib/pop-over.js"),v=r("./app/scripts/lib/util/index.js"),y=r("./app/scripts/views/internal/view.js"),m=r("./node_modules/underscore/underscore.js"),w=r("./app/scripts/views/internal/templates.js"),k=r("./node_modules/moment/moment.js"),b=r("./app/scripts/lib/localize-count.js"),g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(_,e);var t,y,g,j,O=(t=_,function(){var e,r=u(t);if(c()){var n=u(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return o(this,e)});function _(){return n(this,_),O.apply(this,arguments)}return y=_,j=[{key:"initClass",value:function(){this.prototype.events={sortreceive:"sortReceive",sortstop:"sortStop","click .js-expand-day:not(.active)":"expand","click .js-toggle-day":"clickToggleDay"}}}],(g=[{key:"initialize",value:function(e){var t=e.data,r=e.getCardView;return this.data=t,this.getCardView=r,this.$el.attr("name",h.getMidnightInt(this.data.day)),this.cardsDue=this.data.cardsDueOnDate,this.checkItemsDueOnDate=this.data.checkItemsDueOnDate}},{key:"remove",value:function(){return delete this.getCardView,a(u(_.prototype),"remove",this).apply(this,arguments)}},{key:"render",value:function(e){null==e&&(e={});var t=this.data.day,n=h.isFirstOfMonth(t)||h.isLastOfMonth(t),i={date:k(t).format(n?"llll":"D"),isToday:k().isSame(t,"day")};return m.extend(e,i),this.$el.html(w.fill(r("./app/scripts/views/templates/calendar_day.js"),e,{editable:this.model.editable()})),this.renderCardsAndHeaders(),this.renderCheckItems(),this}},{key:"renderCardsAndHeaders",value:function(){return this.updateHeader(),this.renderCardsAndListHeaders()}},{key:"cardListMap",value:function(){return m.groupBy(this.cardsDue,(function(e){return e.getList().id}))}},{key:"updateHeader",value:function(){this.$(".day-cards-header").empty();var e=this.cardsDue.length+this.checkItemsDueOnDate.length;if(e>0)return this.$(".day-cards-header").text(b("items",e))}},{key:"renderCardsAndListHeaders",value:function(){var e=this.$(".js-cards");e.empty();for(var t=[],n=this.cardListMap(),i=0,a=Object.keys(n||{});i<a.length;i++){var s=a[i],o=n[s],c={listID:s,listName:this.model.getList(s).get("name")},u=w.fill(r("./app/scripts/views/templates/calendar_day_list_header.js"),c);t.push(u);for(var d=0,h=Array.from(o);d<h.length;d++){var f=h[d],v=this.getCardView(f);if(!v.$el.hasClass("ui-sortable-helper")){var y=v.render().el;l(y).attr("name",f.cid),v.delegateEvents(),t.push(y)}}}if(e.append(t),this.model.editable())return p.refreshIfInitialized(this.$(".js-calendar-sortable"))}},{key:"renderCheckItems",value:function(){var e=this,t=this.$(".js-check-items-section"),r=this.$(".js-check-items"),n=this.checkItemsDueOnDate.length>0;t.toggleClass("hide",!n);var i=n?this.checkItemsDueOnDate.map((function(t){return e.subview(d,t)})):[];return this.ensureSubviews(i,r)}},{key:"sortReceive",value:function(e,t){var r,n;return r=t.offset,n=document.elementFromPoint(r.left,r.top),l(".calendar-drag-area")[0].contains(n)?(t.item.trigger("moveToCalendarDay",[t,this]),this.renderCardsAndHeaders()):(p.abort(),p.refreshIfInitialized(this.$(".js-calendar-sortable")))}},{key:"sortStop",value:function(e,t){return t.item.trigger("moveInCalendarDay",[t,this])}},{key:"clickToggleDay",value:function(e){return this.$(".calendar-day").hasClass("active")?this.contract(e):this.expand(e)}},{key:"expand",value:function(e){if(v.stop(e),!p.sorting)return l(".calendar-day.active").removeClass("active"),this.$(".calendar-day").addClass("active"),f.hide()}},{key:"contract",value:function(e){return v.stop(e),this.$(".calendar-day").removeClass("active"),f.hide()}}])&&i(y.prototype,g),j&&i(y,j),_}(y);g.initClass(),e.exports=g},"./app/scripts/views/calendar/calendar-month-day-view.js":function(e,t,r){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l,d=r("./app/scripts/views/calendar/calendar-day-view.js");e.exports=((l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(p,e);var t,r,l,d,h=(t=p,function(){var e,r=u(t);if(c()){var n=u(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return o(this,e)});function p(){return n(this,p),h.apply(this,arguments)}return r=p,d=[{key:"initClass",value:function(){this.prototype.tagName="td",this.prototype.className="day-cell"}}],(l=[{key:"initialize",value:function(e){var t=e.scrollIntoView;return this.scrollIntoView=t,a(u(p.prototype),"initialize",this).apply(this,arguments)}},{key:"render",value:function(){return a(u(p.prototype),"render",this).call(this,{monthView:!0})}},{key:"expand",value:function(){a(u(p.prototype),"expand",this).apply(this,arguments);var e=this.$(".calendar-day");return this.scrollIntoView({top:this.$el.prop("offsetTop"),height:e.outerHeight()})}}])&&i(r.prototype,l),d&&i(r,d),p}(d)).initClass(),l=l)},"./app/scripts/views/calendar/calendar-month-view.js":function(e,t,r){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l,d=r("./packages/jquery/index.js"),h=r("./packages/browser/index.ts"),p=r("./app/scripts/views/calendar/calendar-month-day-view.js"),f=r("./app/scripts/views/calendar/calendar-view.js"),v=r("./app/scripts/controller/index.js"),y=r("./app/scripts/lib/dates.js"),m=r("./app/scripts/views/lib/drag-sort.js"),w=r("./app/scripts/views/lib/pop-over.js"),k=r("./app/scripts/lib/util/index.js"),b=r("./app/scripts/lib/window-size.js"),g=r("./node_modules/underscore/underscore.js"),j=r("./app/scripts/views/internal/templates.js"),O=r("./node_modules/moment/moment.js");function _(e,t){return null!=e?t(e):void 0}e.exports=((l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(E,e);var t,l,f,D,C=(t=E,function(){var e,r=u(t);if(c()){var n=u(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return o(this,e)});function E(){return n(this,E),C.apply(this,arguments)}return l=E,D=[{key:"initClass",value:function(){this.prototype.className="u-fancy-scrollbar calendar-drag-area calendar-month",this.prototype.WEEK_WRAPPER_ELEMENT="tr",this.prototype.VIEWSTATE_PREF_STR="month",this.prototype.HEADER_CLASS_NAME="month-view",this.prototype.WEEKS_FROM_EDGE_BEFORE_RENDER_NEW_DAYS=5,this.prototype.WEEKS_TO_RENDER_UPON_SCROLL_THRESHHOLD=5,this.prototype.MINIMUM_WEEKS_KEPT_IN_DOM=20}}],(f=[{key:"initialize",value:function(){return a(u(E.prototype),"initialize",this).apply(this,arguments),this.DAY_VIEW_TYPE=p,this.today=new Date,this.currentMonthCells=[],this.scrollLock=!1,this.weeksKeptInDOM=this.MINIMUM_WEEKS_KEPT_IN_DOM,this.browserIsChrome=h.isChrome(),this.shadeDaysUpdateHeaderDebounced=g.debounce(this.shadeDaysUpdateHeader,100)}},{key:"render",value:function(e){null==e&&(e=this.today),this.$el.html(j.fill(r("./app/scripts/views/templates/calendar_month.js"))),this.renderBaseWeek(e),this.currentCenterWeek=e,this.currentMonth=y.getFirstOfMonth(e);var t=Math.floor(this.weeksKeptInDOM/2);return this.renderWeeks(t),this.renderWeeks(-1*t),this.shadeDays(),this.setSubscriptions(),this}},{key:"getDayView",value:function(e,t){return a(u(E.prototype),"getDayView",this).call(this,e,g.extend({scrollIntoView:this.scrollIntoView.bind(this)},t))}},{key:"addedToDOM",value:function(){return a(u(E.prototype),"addedToDOM",this).apply(this,arguments),this.calculateVariables(),this.windowResizeCheck(),this.updateHeader(),this.scrollToDay(this.currentCenterWeek)}},{key:"updateRoute",value:function(){var e=y.dateToObj(this.currentMonth),t=e.year,r=e.month;if(r=k.lpad(r,2,"0"),v.getBoardUrl(this.model.id,"calendar",[t,r])!==v.location)return v.setBoardLocation(this.model.id,"calendar",[t,r],{replace:!0})}},{key:"setSubscriptions",value:function(){var e=this;return this.stopSubscriptions(),d(b).on("windowClassChange.".concat(this.uniqueId()),this.windowClassChangeCheck.bind(this)),d(window).on("resize.".concat(this.uniqueId()),(function(){return e.windowResizeCheck()})),d(".calendar-month").on("scroll.".concat(this.uniqueId()," "),(function(){return e.scrollCheck()}))}},{key:"stopSubscriptions",value:function(){return d(b).off(".".concat(this.uniqueId())),d(window).off(".".concat(this.uniqueId())),d(".calendar-month").off(".".concat(this.uniqueId()))}},{key:"windowClassChangeCheck",value:function(e,t){if(b.fSmall){d(".calendar-day.active").removeClass("active");var r=new Date(this.currentCenterWeek);return this.calculateVariables(),this.windowResizeCheck(),this.scrollCheck(),this.scrollToDay(r)}}},{key:"calculateVariables",value:function(){var e;return this.tableSpacing=null!=(e=parseInt(this.$(".calendar-table").css("border-spacing"),10))?e:5,this.dayCellHeight=this.$(".day-cell").prop("clientHeight")+this.tableSpacing}},{key:"windowResizeCheck",value:function(){var e=d(window).outerHeight(),t=d("#header").outerHeight(),r=d("#board-header").outerHeight(),n=d(".calendar-header").outerHeight();this.calendarContentHeight=e-(t+r+n);var i=Math.ceil(this.calendarContentHeight/this.dayCellHeight);this.weeksKeptInDOM=Math.max(5*i,this.MINIMUM_WEEKS_KEPT_IN_DOM)}},{key:"updateHeader",value:function(){var e="".concat(O(this.currentMonth).format("MMMM YYYY"));return d(".js-calendar-header").text(e)}},{key:"renderBaseWeek",value:function(e){var t=this.weekRowEl(e);return d(".calendar-month").off(".".concat(this.uniqueId())),this.$(".calendar-table").append(t),this.calculateFirstAndLastWeeksFromDOM()}},{key:"renderWeeks",value:function(e){if(e>0){var t=O(this.lastRenderedSaturday).add(e,"weeks").toDate();this.renderUpToDay(t)}if(e<0){var r=O(this.firstRenderedWeek).add(e,"weeks").toDate();return this.renderUpToDay(r)}}},{key:"renderUpToDay",value:function(e){for(var t=this.$(".calendar-table"),r=y.getEndOfWeek(e),n=[];this.lastRenderedSaturday<r;)this.lastRenderedSaturday=O(this.lastRenderedSaturday).add(1,"weeks").toDate(),n.push(this.weekRowEl(this.lastRenderedSaturday));t.append(n);for(var i=y.getStartOfWeek(e),a=[];this.firstRenderedWeek>i;)this.firstRenderedWeek=O(this.firstRenderedWeek).subtract(1,"weeks").toDate(),a.unshift(this.weekRowEl(this.firstRenderedWeek));t.prepend(a);var s=this.deleteExcessWeeks();return this.browserIsChrome||this.scroll(this.dayCellHeight*(a.length-s)),this.calculateFirstAndLastWeeksFromDOM()}},{key:"deleteExcessWeeks",value:function(){var e=d(".week");if(e.length>this.weeksKeptInDOM){var t,r,n,i,a=this.$(".calendar-table").outerHeight();if(!(d(".calendar-month").prop("scrollTop")<a/2)){var s,o,c=e.length-this.weeksKeptInDOM;for(t=0,s=0<=(o=c);s?t<o:t>o;s?t++:t--)d(e[t]).remove();return c}for(t=i=e.length-1,r=i<=(n=this.weeksKeptInDOM);r?t<=n:t>=n;r?t++:t--)d(e[t]).remove()}return 0}},{key:"scrollToDay",value:function(e,t){if(!this.scrollLock){var r=this.calendarContentHeight/2/this.dayCellHeight,n=O(e).startOf("week"),i=n.clone().subtract(Math.ceil(r),"weeks").toDate(),a=n.clone().add(Math.ceil(r),"weeks").toDate();if(this.firstRenderedWeek<=i&&this.lastRenderedWeek>=a){var s=n.clone().subtract(Math.floor(r),"weeks").toDate(),o=y.getMidnightInt(s),c=this.$("[name='".concat(o,"']")).prop("offsetTop");this.scrollTo(c-this.tableSpacing+1,t)}else this.render(e),this.addedToDOM(),this.delegateEvents();return this.updateRoute()}}},{key:"completeAnimatedScroll",value:function(){return this.enableRenderNewDays()}},{key:"scrollIntoView",value:function(e){var t=e.top,r=t+e.height,n=d(".calendar-month"),i=n.scrollTop(),a=i+n.height();return t<i?this.scroll(t-i-this.tableSpacing+1,this.SCROLL_ANIMATION_TIME):r>a?this.scroll(r-a+this.tableSpacing+1,this.SCROLL_ANIMATION_TIME):void 0}},{key:"scroll",value:function(e,t){var r=d(".calendar-month").prop("scrollTop");return this.scrollTo(r+e,t)}},{key:"scrollTo",value:function(e,t){var r=this,n=d(".calendar-month");return t?(this.scrollLock=!0,n.animate({scrollTop:e},{duration:t,complete:function(){return r.completeAnimatedScroll()}})):n.scrollTop(e)}},{key:"navigatePrevious",value:function(){return this.scrollMonth(-1)}},{key:"navigateNext",value:function(){return this.scrollMonth(1)}},{key:"scrollMonth",value:function(e){if(!this.scrollLock){var t=O(this.currentMonth).add(e,"months").startOf("month").add(15,"days").toDate();return this.scrollToDay(t,this.SCROLL_ANIMATION_TIME)}}},{key:"enableRenderNewDays",value:function(){return this.checkRenderDays(),this.scrollLock=!1}},{key:"scrollCheck",value:function(){w.hide();var e=d(".calendar-month"),t=e.outerHeight(),r=e.prop("scrollTop");this.scrollLock||this.checkRenderDays();var n=t/2,i=Math.floor((r+n)/this.dayCellHeight),a=O(this.firstRenderedWeek).add(i,"weeks").toDate();if(!O(this.currentCenterWeek).isSame(a,"day")){this.currentCenterWeek=a;var s=y.getEndOfWeek(this.currentCenterWeek);this.currentMonth.getMonth()===this.currentCenterWeek.getMonth()&&this.currentMonth.getMonth()===s.getMonth()||(s.getMonth()===this.today.getMonth()?this.currentMonth=y.getFirstOfMonth(s):this.currentMonth=y.getFirstOfMonth(this.currentCenterWeek),this.shadeDaysUpdateHeaderDebounced()),this.updateRoute()}var o=y.getMidnightInt(this.today),c=this.$("[name='".concat(o,"']")),u=_(c.offset(),(function(e){return e.top})),l=_(c.offsetParent().offset(),(function(e){return e.top})),h=l+c.offsetParent().outerHeight(!0),p=l<u&&u<h;return d(".today-button").toggleClass("on-today",p)}},{key:"shadeDaysUpdateHeader",value:function(){return this.updateHeader(),this.shadeDays()}},{key:"checkRenderDays",value:function(){var e,t=d(".calendar-month"),r=t.outerHeight(),n=t.prop("scrollTop"),i=this.$(".calendar-table").outerHeight()-r-n,a=this.dayCellHeight*this.WEEKS_FROM_EDGE_BEFORE_RENDER_NEW_DAYS;if(i<a&&(e=!0,this.renderWeeks(this.WEEKS_TO_RENDER_UPON_SCROLL_THRESHHOLD)),n<a&&(e=!0,this.renderWeeks(-1*this.WEEKS_TO_RENDER_UPON_SCROLL_THRESHHOLD)),e&&this.model.editable())return this.defer((function(){return m.refreshCalendarCardSortable()}))}},{key:"shadeDays",value:function(){for(var e,t=this,r=this.$(".day-cell"),n=0,i=Array.from(this.currentMonthCells);n<i.length;n++)e=i[n],d(e).removeClass("current-month");return this.currentMonthCells=g.filter(r,this.cellInCurrentMonth,this),function(){for(var r=[],n=0,i=Array.from(t.currentMonthCells);n<i.length;n++)e=i[n],r.push(d(e).addClass("current-month"));return r}()}},{key:"cellInCurrentMonth",value:function(e){var t=parseInt(d(e).attr("name"),10);return new Date(t).getMonth()===this.currentMonth.getMonth()}}])&&i(l.prototype,f),D&&i(l,D),E}(f)).initClass(),l=l)},"./app/scripts/views/calendar/calendar-view.js":function(e,t,r){function n(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,r){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var h=r("./packages/jquery/index.js"),p=r("./app/scripts/views/calendar/calendar-card-view.js"),f=r("./app/scripts/lib/dates.js"),v=r("./app/scripts/views/lib/drag-sort.js"),y=r("./app/scripts/views/internal/view.js"),m=r("./node_modules/underscore/underscore.js"),w=r("./node_modules/moment/moment.js"),k=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(b,e);var t,r,i,y,k=(t=b,function(){var e,r=d(t);if(l()){var n=d(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return u(this,e)});function b(){return a(this,b),k.apply(this,arguments)}return r=b,y=[{key:"initClass",value:function(){this.prototype.className="u-fancy-scrollbar calendar-drag-area",this.prototype.SCROLL_ANIMATION_TIME=400}}],(i=[{key:"initialize",value:function(){var e=this.listenToListChanges.bind(this);return this.model.listList.each(e),this.listenTo(this.model.listList,"add remove",e),this.model.openCards().forEach(this.watchChecklistsOnCard.bind(this))}},{key:"addedToDOM",value:function(){if(this.model.editable())return this.defer((function(){return v.refreshCalendarCardSortable()}))}},{key:"delegateEvents",value:function(){return o(d(b.prototype),"delegateEvents",this).apply(this,arguments),Array.from(this.subviewsOfType(this.DAY_VIEW_TYPE)).map((function(e){return e.delegateEvents()}))}},{key:"setSubscriptions",value:function(){throw new Error("CalendarView::setSubscriptions is an abstract method")}},{key:"stopSubscriptions",value:function(){throw new Error("CalendarView::stopSubscriptions is an abstract method")}},{key:"datesForCard",value:function(e){var t=[];return e.get("due")&&t.push(e.get("due")),e.checklistList.forEach((function(e){return e.checkItemList.forEach((function(e){if(e.get("due"))return t.push(e.get("due"))}))})),t}},{key:"listenToListChanges",value:function(e){return this.listenTo(e.cardList,"add remove change:closed",(function(e){return this.renderCardsOnDates(this.datesForCard(e)),this.watchChecklistsOnCard(e)})),this.listenTo(e.cardList,"change:due",(function(e,t){var r=e.previousAttributes().due,n=e.get("due"),i=new Date(null!=r?r:null);if(t=new Date(null!=n?n:null),!w(i).isSame(t,"day")){var a=function(){for(var e=[],t=0,i=[r,n];t<i.length;t++){var a=i[t];null!=a&&e.push(new Date(a))}return e}();return this.renderCardsOnDates(a)}})),this.listenTo(e.cardList,"reset",(function(e,t){var r=this,i=e.models,a=t.previousModels,s=m.difference(i,a),o=m.difference(a,i),c=[].concat(n(Array.from(s)),n(Array.from(o)));s.forEach((function(e){return r.watchChecklistsOnCard(e)}));var u=m.chain(c).map((function(e){return r.datesForCard(e)})).flatten().value();return this.renderCardsOnDates(u)}))}},{key:"watchChecklistsOnCard",value:function(e){var t=this.listenToChecklistChanges.bind(this);return e.checklistList.each(t),this.listenTo(e.checklistList,"add remove",t)}},{key:"listenToChecklistChanges",value:function(e){return this.listenTo(e.checkItemList,"change:due",(function(e,t){var r=e.previous("due"),n=e.get("due");if(!(r&&n&&w(r).isSame(n,"day"))){var i=[r,n].filter((function(e){return e})).map((function(e){return new Date(e)}));return this.renderCardsOnDates(i)}}))}},{key:"navigateToday",value:function(){return this.scrollToDay(this.today,this.SCROLL_ANIMATION_TIME)}},{key:"getCardView",value:function(e){return this.subview(p,e,e.cid)}},{key:"cardsWithDueDates",value:function(e){return e.filter((function(e){return null!=e.get("due")}))}},{key:"cardsDueOnDate",value:function(e,t){return this.cardsWithDueDates(e).filter((function(e){return w(e.get("due")).isSame(t,"day")}))}},{key:"checkItemsDueOnDate",value:function(e,t){return m.chain(e).map((function(e){return e.checklistList.map((function(e){return e.checkItemList.filter((function(e){var r=e.get("due");return null!=r&&w(r).isSame(t,"day")}))}))})).flatten().value()}},{key:"cardSubviews",value:function(){var e=this.subviewsOfType(this.DAY_VIEW_TYPE);return m.flatten(Array.from(e).map((function(e){return e.subviewsOfType(p)})))}},{key:"calculateFirstAndLastWeeksFromDOM",value:function(){var e=this.$(".week");return this.firstRenderedWeek=new Date(parseInt(e.first().attr("name"),10)),this.lastRenderedWeek=new Date(parseInt(e.last().attr("name"),10)),this.lastRenderedSaturday=f.getEndOfWeek(this.lastRenderedWeek)}},{key:"renderCardsOnDates",value:function(e){var t=this;if(this.$(".week").length>0){var r=m.chain(e).compact().map((function(e){return f.getMidnightInt(e)})).uniq().sort().map((function(e){return new Date(e)})).value();return function(){for(var e=[],n=0,i=Array.from(r);n<i.length;n++){var a=i[n];if(t.firstRenderedWeek<a&&a<t.lastRenderedSaturday){var s=t.model.openCards(),o=f.getMidnightInt(a),c=t.existingSubview(t.DAY_VIEW_TYPE,t.model,o);c.cardsDue=t.cardsDueOnDate(s,a),c.checkItemsDueOnDate=t.checkItemsDueOnDate(s,a),c.renderCardsAndHeaders(),e.push(c.renderCheckItems())}}return e}()}}},{key:"renderDayViews",value:function(e){var t=this;return Array.from(e).map((function(e){return t.getDayView(e).render().el}))}},{key:"getDayView",value:function(e,t){var r=this.model.openCards(),n={day:e,cardsDueOnDate:this.cardsDueOnDate(r,e),checkItemsDueOnDate:this.checkItemsDueOnDate(r,e)};return this.subview(this.DAY_VIEW_TYPE,this.model,m.extend({data:n,getCardView:this.getCardView.bind(this)},t),f.getMidnightInt(e))}},{key:"weekRowEl",value:function(e){var t=this.renderDayViews(f.getDaysOfWeek(e)),r=h(document.createElement(this.WEEK_WRAPPER_ELEMENT));return r.attr("name",f.getMidnightInt(f.getStartOfWeek(e))).addClass("week").append(t),r}}])&&s(r.prototype,i),y&&s(r,y),b}(y);k.initClass(),e.exports=k},"./app/scripts/views/calendar/calendar-week-day-view.js":function(e,t,r){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u,l=r("./app/scripts/views/calendar/calendar-day-view.js");e.exports=((u=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(h,e);var t,r,u,l,d=(t=h,function(){var e,r=c(t);if(o()){var n=c(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return s(this,e)});function h(){return n(this,h),d.apply(this,arguments)}return r=h,l=[{key:"initClass",value:function(){this.prototype.className="day-column"}}],(u=null)&&i(r.prototype,u),l&&i(r,l),h}(l)).initClass(),u=u)},"./app/scripts/views/calendar/calendar-week-view.js":function(e,t,r){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l,d=r("./packages/jquery/index.js"),h=r("./app/scripts/views/calendar/calendar-view.js"),p=r("./app/scripts/views/calendar/calendar-week-day-view.js"),f=r("./app/scripts/controller/index.js"),v=r("./app/scripts/lib/dates.js"),y=r("./app/scripts/views/lib/drag-sort.js"),m=r("./app/scripts/lib/util/index.js"),w=r("./app/scripts/views/internal/templates.js"),k=r("./node_modules/moment/moment.js");e.exports=((l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(j,e);var t,l,h,b,g=(t=j,function(){var e,r=u(t);if(c()){var n=u(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return o(this,e)});function j(){return n(this,j),g.apply(this,arguments)}return l=j,b=[{key:"initClass",value:function(){this.prototype.className="u-fancy-scrollbar calendar-drag-area calendar-week",this.prototype.WEEK_WRAPPER_ELEMENT="div",this.prototype.VIEWSTATE_PREF_STR="week",this.prototype.HEADER_CLASS_NAME="week-view",this.prototype.WEEKS_KEPT_IN_DOM=5}}],(h=[{key:"initialize",value:function(){return a(u(j.prototype),"initialize",this).apply(this,arguments),this.DAY_VIEW_TYPE=p,this.today=new Date,this.scrollLock=!1}},{key:"render",value:function(e){return null==e&&(e=this.today),this.$el.html(w.fill(r("./app/scripts/views/templates/calendar_week.js"))),this.currentWeek=v.getStartOfWeek(e),this.appendWeekEl(this.currentWeek),this.prependWeekEl(k(this.currentWeek).subtract(1,"weeks").toDate()),this.appendWeekEl(k(this.currentWeek).add(1,"weeks").toDate()),this}},{key:"addedToDOM",value:function(){return a(u(j.prototype),"addedToDOM",this).apply(this,arguments),this.weekWidth=d(".calendar-content").outerWidth(),this.resizeWeekCanvas(),this.scrollToDay(this.currentWeek),this.updateToolbar()}},{key:"updateRoute",value:function(){var e=v.dateToObj(this.currentWeek),t=e.year,r=e.month,n=e.day;return r=m.lpad(r,2,"0"),n=m.lpad(n,2,"0"),f.setBoardLocation(this.model.id,"calendar",[t,r,n],{replace:!0})}},{key:"setSubscriptions",value:function(){var e=this;return d(window).on("resize.".concat(this.uniqueId()),(function(){return e.resizeCheck()})),d(".board-menu").on("transitionend.".concat(this.uniqueId()," webkitTransitionEnd.").concat(this.uniqueId()),(function(){return e.resizeCheck()}))}},{key:"stopSubscriptions",value:function(){return d(window).off(".".concat(this.uniqueId())),d(".board-menu").off(".".concat(this.uniqueId()))}},{key:"resizeCheck",value:function(){return this.weekWidth=d(".calendar-content").outerWidth(),this.resizeWeekCanvas(),this.scrollToDay(this.currentWeek)}},{key:"resizeWeekCanvas",value:function(){var e=this.$(".week").length;return d(".week-horizontal-canvas").width(this.weekWidth*e),d(".week").width(this.weekWidth)}},{key:"updateToolbar",value:function(){var e=k(v.getEndOfWeek(this.currentWeek)),t=k(this.currentWeek),r="".concat(t.format("LL")," - ").concat(e.format("LL"));d(".js-calendar-header").text(r);var n=d(".today-button"),i=k(this.today).isSame(this.currentWeek,"week");return n.toggleClass("on-today",i)}},{key:"appendWeekEl",value:function(e){this.$(".week-horizontal-canvas").append(this.weekRowEl(e)),this.resizeWeekCanvas();var t=this.$(".week");return t.length>this.WEEKS_KEPT_IN_DOM&&(t.first().remove(),this.scrollLeft(-1*this.weekWidth)),this.calculateFirstAndLastWeeksFromDOM()}},{key:"prependWeekEl",value:function(e){this.$(".week-horizontal-canvas").prepend(this.weekRowEl(e));var t=this.$(".week");return t.length>this.WEEKS_KEPT_IN_DOM&&t.last().remove(),this.resizeWeekCanvas(),this.scrollLeft(this.weekWidth),this.calculateFirstAndLastWeeksFromDOM()}},{key:"navigatePrevious",value:function(){return this.navigateWeek({backwards:!0})}},{key:"navigateNext",value:function(){return this.navigateWeek({backwards:!1})}},{key:"navigateWeek",value:function(e){null==e&&(e={});var t=e.backwards;if(!this.scrollLock){var r=t?-1:1,n=t?this.$(".week").first():this.$(".week").last();this.currentWeek=k(this.currentWeek).add(r,"weeks");var i=n.attr("name"),a=new Date(parseInt(i,10));return k(this.currentWeek).isSame(a,"day")&&(t?this.prependWeekEl(k(this.currentWeek).subtract(1,"weeks").toDate()):this.appendWeekEl(k(this.currentWeek).add(1,"weeks").toDate()),this.model.editable()&&this.defer((function(){return y.refreshCalendarCardSortable()}))),this.scrollToDay(this.currentWeek,this.SCROLL_ANIMATION_TIME)}}},{key:"scrollLeft",value:function(e,t){var r=d(".calendar-week").prop("scrollLeft");return this.scrollLeftTo(r+e,t)}},{key:"scrollLeftTo",value:function(e,t){var r=this,n=d(".calendar-week");return t?(this.scrollLock=!0,n.animate({scrollLeft:e},{duration:t,complete:function(){return r.completeAnimatedScroll()}})):n.scrollLeft(e)}},{key:"scrollToDay",value:function(e,t){if(this.firstRenderedWeek<e&&e<this.lastRenderedSaturday){var r=v.getMidnightInt(v.getStartOfWeek(e)),n=this.$(".week[name='".concat(r,"']")).prop("offsetLeft");this.scrollLeftTo(n,t),this.currentWeek=new Date(r),this.updateToolbar()}else this.render(e),this.addedToDOM(),this.delegateEvents();return this.updateRoute()}},{key:"completeAnimatedScroll",value:function(){return this.scrollLock=!1}}])&&i(l.prototype,h),b&&i(l,b),j}(h)).initClass(),l=l)},"./app/scripts/views/card-composer/calendar-card-composer-view.js":function(e,t,r){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t,r){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l=r("./packages/jquery/index.js"),d=r("./packages/atlassian-analytics/index.ts").Analytics,h=r("./packages/feature-flag-client/index.ts").featureFlagClient,p=r("./packages/keybindings/index.ts"),f=p.getKey,v=p.Key,y=r("./app/scripts/views/lib/pop-over.js"),m=r("./app/scripts/lib/util/index.js"),w=r("./app/scripts/views/internal/view.js"),k=r("./node_modules/underscore/underscore.js"),b=r("./app/scripts/views/internal/templates.js"),g=r("./app/scripts/lib/localize.js"),j=r("./app/scripts/views/card/card-limits-error.js").maybeDisplayLimitsErrorOnCardAdd,O=r("./node_modules/moment/moment.js"),_=r("./app/scripts/views/card/date-picker-view.js"),D="LT",C=[D,"h:mm A"],E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(T,e);var t,p,w,E,R=(t=T,function(){var e,r=u(t);if(c()){var n=u(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return o(this,e)});function T(){return n(this,T),R.apply(this,arguments)}return p=T,E=[{key:"initClass",value:function(){this.prototype.className="calendar-card-composer",this.prototype.events={"change .js-select-list":"updatePositionList","change .js-select-position":"renderValues","click .js-add-card":"addCard","input .js-dpicker-time-input":"validateTimeInput","change .js-dpicker-time-input":"normalizeTimeInput",keydown:"keydownEvent"},this.prototype.viewTitleKey="add card"}}],(w=[{key:"initialize",value:function(e){return this.board=this.model.getBoard()}},{key:"setDate",value:function(e){this.date=e;var t=_.lastDueDate;return t?this.date.setHours(t.getHours(),t.getMinutes()):this.date.setHours(12)}},{key:"remove",value:function(){var e={title:this.$(".js-card-title").val(),idList:this.$(".js-select-list").val(),pos:this.$(".js-select-position").val()};return this.model.set(e).save(),a(u(T.prototype),"remove",this).apply(this,arguments)}},{key:"render",value:function(){var e=this,t={title:this.model.get("title"),dueTime:O(this.date).format(D)};return this.$el.html(b.fill(r("./app/scripts/views/templates/popover_card_from_calendar.js"),t)),this.updateListList(),this.updatePositionList(),setTimeout((function(){return m.setCaretAtEnd(e.$(".js-card-title")[0])}),5),this}},{key:"keydownEvent",value:function(e){f(e)!==v.Enter||this.addCard(e)}},{key:"addCard",value:function(e){m.stop(e);var t=l.trim(this.$(".js-card-title").val());if(t){var r="";h.get("dataeng.vitalstats-create-card",!1)&&(r=d.startTask({taskName:"create-card",subTask:"calendar",source:"calendarCardComposerInlineDialog"}));var n=this.selectedList(),i={$elem:l(e.target),destinationBoard:this.board,destinationList:n};if(!j(i)){y.hide(),this.model.clearItems(),this.model.set("pos","bottom");var a=parseInt(this.$(".js-select-position").val(),10),s=this.selectedTimeMoment();this.date.setHours(s.hour(),s.minute()),_.lastDueDate=this.date;var o={closed:!1,dateLastActivity:new Date,due:this.date.toString(),idList:n.id,pos:n.calcPos(a),name:t};n.cardList.create(o,{traceId:r,success:function(e){d.sendTrackEvent({action:"created",actionSubject:"card",source:"calendarCardComposerInlineDialog",containers:{card:{id:e.id},list:{id:n.id},board:{id:n.getBoard().id}},attributes:{taskId:r}}),h.get("dataeng.vitalstats-create-card",!1)&&d.taskSucceeded({taskName:"create-card",subTask:"calendar",traceId:r,source:"calendarCardComposerInlineDialog"})},error:function(e){throw h.get("dataeng.vitalstats-create-card",!1)&&d.taskFailed({taskName:"create-card",subTask:"calendar",traceId:r,source:"calendarCardComposerInlineDialog"}),e}})}}}},{key:"updateListList",value:function(){var e=this.$(".js-select-list");e.empty();var t=this.board.listList.models;return k.each(t,(function(t){return l("<option>").val(t.id).text(t.get("name")).appendTo(e)})),e.val(this.model.get("idList")),e.val()||e.find("option").first().prop("selected",!0),this.renderValues()}},{key:"updatePositionList",value:function(){var e=this.$(".js-select-position"),t=this.selectedList();if(e.empty(),null!=t){var r=function(e,t,r){for(var n=[],i=e<t,a=r?i?t+1:t-1:t,s=e;i?s<a:s>a;i?s++:s--)n.push(s);return n}(0,t.cardList.length,!0);k.each(r,(function(t){var n=function(){switch(t){case 0:return" (Top)";case r.length-1:return" (Bottom)";default:return""}}();return l("<option>").val(t).text(t+1+n).appendTo(e)})),e.val(this.model.get("pos")),e.val()||e.find("option").last().prop("selected",!0)}return this.renderValues()}},{key:"selectedList",value:function(){var e=this.$(".js-select-list").val();return k.findWhere(this.board.listList.models,{id:e})}},{key:"renderValues",value:function(){var e=this.selectedList(),t=this.$(".js-list-value"),r=this.$(".js-pos-value");if(null!=e){t.text(e.get("name"));var n=parseInt(this.$(".js-select-position").val(),10);r.text(n+1)}else t.empty().append(l("<i></i>").text(g("no lists"))),r.empty().append(l("<i></i>").text(g("n/a")));this.$(".js-add-card,.js-card-title").prop("disabled",null==e)}},{key:"validateTimeInput",value:function(){return this.$timeInput().toggleClass("input-error",!this.isTimeInputValid())}},{key:"normalizeTimeInput",value:function(){return this.$timeInput().val(this.selectedTimeMoment().format(D)),this.validateTimeInput()}},{key:"selectedTimeMoment",value:function(){return this.isTimeInputValid()?O(this.$timeInput().val(),C):O().hours(12).minutes(0)}},{key:"$timeInput",value:function(){return this.$(".js-dpicker-time-input")}},{key:"isTimeInputValid",value:function(){return e=this.$timeInput().val(),O(e,C).isValid();var e}}])&&i(p.prototype,w),E&&i(p,E),T}(w);E.initClass(),e.exports=E},"./app/scripts/views/templates/calendar_day.js":function(e,t,r){var n=r("./app/scripts/views/internal/teacup-with-helpers.js")("calendar_day"),i=function(){return n.div({class:"calendar-day js-expand-day ".concat(n.mustacheBlock("isToday",(function(){return"today"})))},(function(){return n.div(".day-header.u-clearfix.js-toggle-day",(function(){return n.h3(".date",(function(){return n.text(n.mustacheVar("date"))})),n.div(".quiet.num-cards",(function(){return n.div(".day-cards-header")})),n.a(".close-button.icon-sm.icon-close.dark-hover",{href:"#"})})),n.div(".calendar-day-list.u-fancy-scrollbar.js-calendar-sortable",(function(){return n.div(".calendar-cards-section.js-cards",(function(){})),n.div(".js-check-items-section",(function(){return n.span(".calendar-list-header",(function(){return n.icon("checklist"),n.text(" "),n.format("checklist-items")})),n.div(".js-check-items",(function(){}))}))})),n.mustacheBlock("__ed",(function(){return n.a(".calendar-card-composer.nch-button.js-open-card-composer",{href:"#"},(function(){return n.format("add-a-card-ellipsis")}))}))}))};e.exports=function(){return n.mustacheVar("monthView")?n.div(".calendar-day-spacer-div",i):i()}},"./app/scripts/views/templates/calendar_day_list_header.js":function(e,t,r){var n=r("./app/scripts/views/internal/teacup-with-helpers.js")("calendar_day_list_header");e.exports=function(){return n.span(".calendar-list-header",{name:n.mustacheVar("listID")},(function(){return n.icon("list"),n.text(" "),n.text(n.mustacheVar("listName"))}))}},"./app/scripts/views/templates/calendar_month.js":function(e,t,r){var n=r("./app/scripts/views/internal/teacup-with-helpers.js")("calendar_month");e.exports=function(){return n.table(".calendar-table")}},"./app/scripts/views/templates/calendar_toolbar.js":function(e,t,r){var n=r("./app/scripts/views/internal/teacup-with-helpers.js")("calendar_toolbar");e.exports=function(){return n.div(".calendar-header",(function(){return n.div(".calendar-header-toolbar",(function(){n.div(".calendar-header-toolbar-nav",(function(){return n.button(".button.icon-button.js-left-arrow.left-arrow",{href:"#"},(function(){return n.icon("up")})),n.button(".button.today-button.js-today",{href:"#"},(function(){return n.format("today")})),n.button(".button.icon-button.js-right-arrow.right-arrow",{href:"#"},(function(){return n.icon("down")}))})),n.h2(".calendar-header-toolbar-title.js-calendar-header"),n.div(".calendar-header-toolbar-right",(function(){return n.mustacheVar("dismissedFeedback")||n.div(".calendar-header-toolbar-feedback",(function(){return n.a(".calendar-header-feedback-link",{href:"https://trello.typeform.com/to/YkqfcICY",target:"_blank"},(function(){return n.format("feedback")})),n.a(".icon-sm.icon-close.dark-hover.js-disable-feedback")})),n.div(".calendar-header-toolbar-type",(function(){return n.button(".button.js-week-view.week-button",{href:"#"},(function(){return n.format("week")})),n.button(".button.js-month-view.month-button",{href:"#"},(function(){return n.format("month")}))})),n.div(".calendar-header-toolbar-setting-close",(function(){return n.a(".icon-lg.icon-gear.dark-hover.js-calendar-settings",{href:"#"}),n.a(".icon-lg.icon-close.dark-hover.js-close-calendar",{href:"#"})}))}))})),n.div(".days-of-week",(function(){return n.mustacheBlock("days",(function(){return n.div(".quiet",(function(){return n.text(n.mustacheVar("."))}))}))}))})),n.div(".calendar-content")}},"./app/scripts/views/templates/calendar_week.js":function(e,t,r){var n=r("./app/scripts/views/internal/teacup-with-helpers.js")("calendar_week");e.exports=function(){return n.div(".week-horizontal-canvas")}},"./app/scripts/views/templates/popover_card_from_calendar.js":function(e,t,r){var n=r("./app/scripts/views/internal/teacup-with-helpers.js")("popover_card_from_calendar");e.exports=function(){return n.div((function(){return n.label((function(){return n.format("title")})),n.textarea(".js-card-title",(function(){return n.text(n.mustacheVar("title"))}))})),n.div((function(){return n.label((function(){return n.format("time")})),n.input(".datepicker-select-input.js-dpicker-time-input",{type:"text",value:n.mustacheVar("dueTime")})})),n.div(".button-link.list-button-link.setting",(function(){return n.span(".label",(function(){return n.format("list")})),n.span(".value.js-list-value"),n.label((function(){return n.format("list")})),n.select(".js-select-list")})),n.div(".button-link.pos-button-link.setting",(function(){return n.span(".label",(function(){return n.format("position")})),n.span(".value.js-pos-value"),n.label((function(){return n.format("position")})),n.select(".js-select-position")})),n.input(".primary.wide.js-add-card",{type:"submit",value:n.l("add")})}}}]);
//# sourceMappingURL=calendar-controller-view.a70011b0863737619eb7.js.map